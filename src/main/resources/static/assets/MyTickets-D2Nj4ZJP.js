import{y,d as V,q as D,r as d,c as p,b as B,F as k,e as S,a as l,k as c,h as L,i as u,j as w,l as v,Q as O,s as R,z as $,E,_ as U}from"./index-DeSWxAP-.js";import{_ as j,g as z,T as F,q as A,p as H,d as G}from"./TrainTicketInfo-BxrpNpg-.js";const q=n=>y({url:"/station/name",params:{s_id:n}}),J=n=>y({url:"/station/beginTime",params:{t_id:n}}),K=n=>y({url:"/station/arrivalTime",params:{t_id:n}}),W={class:"my-tickets-container"},X={class:"history"},Y=V({__name:"MyTickets",setup(n){const M=D(),T=d([]);async function m(){var a;const t=(await z((a=await M.getUserInfo())==null?void 0:a.id)).map(async e=>{const[s,g,o,r]=await Promise.all([q(e.beginStation),q(e.arriveStation),J(e.beginTid),K(e.arriveTid)]);return{...e,begin_station_name:s,arrive_station_name:g,begin_time:o.slice(0,5),arrive_time:r.slice(0,5),begin_date:"",arrive_date:""}});T.value=await Promise.all(t)}m();const _=d();let h=0,b=0;function N(i,t){var a;h=i,b=t,(a=_.value)==null||a.show()}const f=d({begin_station_name:"",arrive_station_name:"",start_date:""});async function I(i){f.value=i;const t=await A(f.value);C.value=t.map(R)}async function P(i,t,a,e,s){var x;const g=`${(e.hours+e.days*24).toString().padStart(2,"0")}:${e.minutes.toString().padStart(2,"0")}:${e.wholeSeconds.toString().padStart(2,"0")}`,o=s-b;let r="";o>0?r=`需补差价${o.toFixed(2)}元`:o<0?r=`可退差价${(-o).toFixed(2)}元`:r="无需退、补费用",await $.confirm(`确定改签吗?${r}`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await H({o_id:h,h_id:i,begin_tid:t,arrive_tid:a,duration:g}),E.success("改签成功!正在刷新..."),(x=_.value)==null||x.hide(),m()}async function Q(i){await $.confirm("确定退票吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await G(i),E.success("退票成功!正在刷新..."),m()}const C=d([]);return(i,t)=>{const a=L("ElButton");return u(),p(k,null,[B("div",W,[B("ul",X,[(u(!0),p(k,null,S(T.value,e=>(u(),w(F,{key:e.o_id,data:{...e,cost:e.fee,left_tickets:0,hideLeft:!0}},{default:c(()=>[l(a,{type:"success",disabled:e.ticketChange,onClick:s=>N(e.oid,e.fee)},{default:c(()=>t[0]||(t[0]=[v("改签")])),_:2},1032,["disabled","onClick"]),l(a,{type:"danger",onClick:s=>Q(e.oid)},{default:c(()=>t[1]||(t[1]=[v("退票")])),_:2},1032,["onClick"])]),_:2},1032,["data"]))),128))])]),l(j,{ref_key:"dialogRef",ref:_,"show-close":"",width:"96%"},{default:c(()=>[l(O,{inline:"",callback:I}),(u(!0),p(k,null,S(C.value,e=>(u(),w(F,{data:{...e,...f.value}},{default:c(()=>[l(a,{type:"primary",onClick:s=>P(e.h_id,e.begin_tid,e.arrive_tid,e.duration,e.cost)},{default:c(()=>t[2]||(t[2]=[v("选择 ")])),_:2},1032,["onClick"])]),_:2},1032,["data"]))),256))]),_:1},512)],64)}}}),te=U(Y,[["__scopeId","data-v-eea6101a"]]);export{te as default};
